<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<title>Environmental Education Tools - Matrix Algebra</title>
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../../localsite/css/base.css"  />
<script type="text/javascript" src="../../../localsite/js/d3.v5.min.js"></script>
<script type="text/javascript" src="../../../localsite/js/jquery/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../../localsite/js/localsite.js"></script>
<script type="text/javascript" src="../../../localsite/js/navigation.js"></script>


<!-- For LaTex -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>

<!--
  Equation formatting example:
  /io/naics/add/
-->



<style type="text/css">
body {
  font-size: 16px;
}
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 14px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
  line-height:40px;
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}

.equ {
  font-size: 24px;
  display: inline-block !important;
  border-left: 5px solid #ddd !important;
  background-color: none !important;
  background: none !important;
  marginX: 30px 0 40px 0 !important;
  padding: 0 0 0 20px !important;
  font-family: inherit !important;
  color: #555;
  line-height: .5em;
}
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">

<br>
<h1>Learn about Input-Output Model Construction</h1>

<h4 class="title toc-ignore">A course for Dummies (like me) on Matrix Algebra and Factor Preparation</h4>
</div>

<p>We use <a href="https://en.wikipedia.org/wiki/Matrix_(mathematics)">matrix algebra</a> to represent the steps for creating the Environmentally-Extended EEIO models, using conventions for variable names commonly used in the IO literature and the existing USEEIO model documentation when possible.<br><br>

<b>A Matrix is simply a spreadsheet - a two dimensional table of data</b>

<ul>
  <li>Capital letters indicate matrices and lower case letters vectors.</li>

  <li>“^” over a variable represents the diagonalization of a vector as a matrix.</li>

  <li>An exponent of “-1” represents an inverse.</li>

  <li>A “<span class="math inline">\('\)</span>” (prime) represents the transposed (rows and columns switched) form of a matrix or vector.</li>
</ul>

</p>
<p>

 For related matrix info see the <a href="https://github.com/USEPA/useeior/blob/master/format_specs/Model.md#model-component-matrices">USEEIO Model Component Matrices</a> and the <a href="https://s3.amazonaws.com/useeio-api-go-swagger-staging/index.html">USEEIO API summary</a><br>


<style type="text/css">
td {
  border: 1px solid #ccc;
  padding: 10px;
}
#matrix_examples img {
  margin-top: 10px;
}
</style>
<table id="matrix_examples">
<thead>
<tr>
<th>Item</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>models</td>
<td>metadata</td>
<td>A list of USEEIO models provided</td>
</tr>
<tr>
<td>\(A\)</td>
<td>component</td>
<td>The direct requirements matrix for a given model.<br>
<img src="img/A.png"></td>
</tr>
<tr>
<td>\(B\)</td>
<td>component</td>
<td>The satellite matrix for a given model<br>
<img src="img/B.png"></td>
</tr>
<tr>
<td>\(C\)</td>
<td>component</td>
<td>The characterization factor matrix for a given model<br>
<img src="img/C.png"></td>
</tr>
<tr>
<td>\(D\)</td>
<td>component</td>
<td>The direct impact matrix for a given model</td>
</tr>
<tr>
<td>\(F\)</td>
<td>component</td>
<td><br>
<img src="img/F.png"></td>
</tr>
<tr>
<td>\(L\)</td>
<td>component</td>
<td>The Leontief inverse matrix for a given model</td>
</tr>
<tr>
<td>\(U\)</td>
<td>component</td>
<td>The total impact matrix for a given model</td>
</tr>
<tr>
<td>\(V\)</td>
<td>component</td>
<td>The Make table</td>
</tr>
<tr>
<td>\(B_{dqi}\)</td>
<td>component</td>
<td>Data quality scores for the B matrix for a given model</td>
</tr>
<tr>
<td>\(D_{dqi}\)</td>
<td>component</td>
<td>Data quality scores for the D matrix for a given model</td>
</tr>

<tr>
<td>\(N\)</td>
<td>component</td>
<td></td>
</tr>

<tr>
<td>\(U_{dqi}\)</td>
<td>component</td>
<td>Data quality scores for the U matrix for a given model</td>
</tr>
<tr>
<td>sectors</td>
<td>metadata</td>
<td>A list of sectors in a given model</td>
</tr>
<tr>
<td>flows</td>
<td>metadata</td>
<td>A list of flows in a given model</td>
</tr>
<tr>
<td>indicators</td>
<td>metadata</td>
<td>A list of indicators in a given model</td>
</tr>
<tr>
<td>demands</td>
<td>metadata</td>
<td>A list of demand vectors available for use with a given model</td>
</tr>
</tbody>
</table>
<br>


<h2>USEEIO Methology</h2>

<a href="https://github.com/USEPA/USEEIO_API">Overview of each matrix (array of numbers)</a> and 
<a href="https://github.com/USEPA/USEEIO_API/blob/master/doc/data_format.md">Data formats for sectors, flows and LCIA categories</a><br><br>

Technology matrix (<span class="math inline">\(A\)</span>) does not include wages (compensation), taxes, nor gross opperating surplus (profits)  
"Value Added" is the sum of wages, taxes and profits.<br><br>

Environmental matrix (<span class="math inline">\(B\)</span>) = Emission per dollar<br>
Total industry (emission) / output <br><br>

<span class="math inline">\(D\)</span> and <span class="math inline">\(U\)</span> matrices are the results.<br><br>

<a href="https://model.earth/community/img/overview/useeio-methodology.png"><img src="../../../community/img/overview/useeio-methodology.png" style="width:100%;max-width:800px"></a><br>

Source: <a href="https://www.energy.gov/sites/prod/files/2019/04/f61/Integrated%20life%20cycle%20sustainability%20analysis%20%28ILCSA%29_NL0027593.pdf">DOE Bioenergy Technologies Office (BETO) - 2019 Project Peer Review</a>




<div id="model-construction" class="section level2">
<h2>Model Construction</h2>

We'll use green house gas emissions as an example.<br><br>

<b>Supply Chain Greenhouse Gas&nbsp;(GHG) emission&nbsp;Factors 
for&nbsp;US&nbsp;Industries&nbsp;and&nbsp;Commodities</b><br>

The national totals of the Greenhouse Gas (GHG) Emissions by industry must be transformed into a matrix of coefficients in the form of national total per industry, also referred to as the GHG satellite account, represented as <span class="math inline">\(B\)</span> in the following equation, with a subscript of <span class="math inline">\(I\)</span> denoting its industry form, and <span class="math inline">\(t\)</span> denoting the USD year the same year as the IO data.</p>

<p><span class="math display">

<span class="equ">
  $$B_{I,t} = E_{I,s}\hat{x}^{-1}_{s,t}$$
</span>
</span></p>
<p>In the above equation, <span class="math inline">\(E_I\)</span> is a emission x industry matrix of national totals of each GHG by industy sector in year <span class="math inline">\(s\)</span>, and <span class="math inline">\(x_{s,t}\)</span> is a vector of gross output by industry in year <span class="math inline">\(s\)</span>, given in year <span class="math inline">\(t\)</span> dollars. The industries in the <span class="math inline">\(E\)</span> columns match the industries in <span class="math inline">\(x\)</span>.</p>
<br>

<p>For <span class="math inline">\(x_s\)</span> to be in year <span class="math inline">\(t\)</span> USD, <span class="math inline">\(x\)</span> must first be price adjusted in the following equation,<br>

<span class="math display">
<br><span class="equ">
  $$x_{i,s} = x_{i,a}*\rho_{i,a \rightarrow b}$$
</span>
</span></p>

<p>where <span class="math inline">\(x_{i,a}\)</span> is the year industry ouput for industry <span class="math inline">\(i\)</span> in the currency year, <span class="math inline">\(s\)</span>, corresponding to the year of the national GHG totals. <span class="math inline">\(\rho\)</span> is a price adjustment factor for industry <span class="math inline">\(i\)</span> from currency year <span class="math inline">\(s\)</span> to <span class="math inline">\(t\)</span> USD. <span class="math inline">\(\rho\)</span> for industry <span class="math inline">\(i\)</span> is prepared using the following equation, <span class="math display">

<br><br><span class="equ">
  $$\rho_{i,a \rightarrow b} = \frac{cpi_{i,b}}{cpi_{i,a}}$$
</span>
</span></p>
<p>where <span class="math inline">\(\rho\)</span> from currency year <span class="math inline">\(a\)</span> to <span class="math inline">\(b\)</span> is the ratio of the industry chain price index for year <span class="math inline">\(b\)</span> to that of year <span class="math inline">\(a\)</span>. These equations are used for each industry in the given model.</p>
<p>The core of an IO model is a direct requirements matrix, <span class="math inline">\(A\)</span>, representing the dollar inputs from other sectors per dollar output. Two <span class="math inline">\(A\)</span> matrices are derived, one in commodity x commodity form, <span class="math inline">\(A_C\)</span>, and the other in industry by industry form, <span class="math inline">\(A_I\)</span>. Both are created using a combination of normalized forms of the Make and Use tables. The Make table is normalized by the commodity output vector, <span class="math inline">\(q\)</span>, and the Use table by the industry output vector, <span class="math inline">\(x\)</span>. The only difference between <span class="math inline">\(A_C\)</span> and <span class="math inline">\(A_I\)</span> is the order of multiplication, as shown in the following two equations. <span class="math display">

<br><br><span class="equ">
  $$A_C = U\hat{x}^{-1} * V\hat{q}^{-1}$$
</span>
</span>
<br>

<span class="math display">
<br><span class="equ">
  $$A_C = U\hat{x}^{-1} * V\hat{q}^{-1}$$
</span>
</span></p>
<p>Another name for <span class="math inline">\(V\hat{q}^{-1}\)</span> is the Market Shares matrix. The GHG satellite table for the commodity models must be transformed by this matrix to be in emission x commodity form, using the following equation. <span class="math display">

<br><br><span class="equ">
  $$B_C = B_I * V\hat{q}^{-1}$$
</span>
</span></p>
<p>The items of the <span class="math inline">\(B_c\)</span> matrix represent direct emission factors for commodities.</p>
<p>The final factors must be calculated by calculating a total requirements matrix. Leontief first showed this could be done by subtracting the <span class="math inline">\(A\)</span> matrix from an identity matrix, and taking its inverse. Supply chain emission factors can be calculated by taking the product of the <span class="math inline">\(B\)</span> matrix of direct emission factors by the total requirements matrix, <span class="math inline">\(L\)</span>, where <span class="math inline">\(L\)</span> is defined as</p>
<p><span class="math display">
<span class="equ">
  $$L_C = (I - A_C)^{-1}$$
</span>
</span></p>
<p><span class="math display">

<span class="equ">
  $$L_I = (I - A_I)^{-1}$$
</span>
</span></p>
<p>The following two equations show this calculation for the industry and commodity, where</p>
<p><span class="math display">

<span class="equ">
  $$M_{I} = B_I * L_I$$
</span>
</span></p>
<p><span class="math display">

<span class="equ">
  $$M_{C} = B_C * L_C$$
</span>
</span></p>
<p>This result in emission x sector matrices, <span class="math inline">\(M\)</span>, of supply chain factors, which include direct and indirect emissions per dollar produced for each sector. The factors in <span class="math inline">\(M\)</span> have to be further transformed into purchaser price using sector-specific marginal cost data. Marginal cost data includes cost for distributions, wholesale and retail of commodity. This can be done by creating a vector or marginal cost ratios, <span class="math inline">\(\Phi_c\)</span>, both for commodities and industries for their respective models, as in the following equations.</p>
<p><span class="math display">

<span class="equ">
  $$\bar{M}_{C} = M_{C}* \hat{\Phi_c}$$
</span>
</span></p>
<p><span class="math display">

<span class="equ">
  $$\bar{M}_{I} = M_{I}* \hat{\Phi_I}'$$
</span>
</span></p>
<p><span class="math inline">\(\Phi_c\)</span> is a vector of commodity specific purchaser to producer prices. <span class="math display">

<br><br><span class="equ">
  $$\Phi_C = \frac{q_{pur,c}}{q_{pro,c}}$$
</span>
</span></p>
<p>For use in industry models, commodity margin factors, <span class="math inline">\(\Phi_c\)</span>, need to be transformed into industry margin factors. A commodity x industry “commodity mix” matrix <span class="citation">[@miller_blair]</span>, <span class="math inline">\(V\hat{x}^{-1}\)</span>, can be used for this purpose.</p>
<p><span class="math display">

<span class="equ">
  $$\Phi_I = \hat{\Phi_C} * V\hat{x}^{-1}$$
</span>
</span></p>
<p>where, commodity mix matrix, a commodity x industry matrix representing the mix of commodities being produced by industries.</p>
<p>To identify the root sources of emissions for a given supply chain factor in <span class="math inline">\(M\)</span>, we assume $1 million USD in demand for the related sector, and calculate a scaling vector, <span class="math inline">\(s\)</span>, as <span class="math display">

<br><br><span class="equ">
  $$s = (I - A)^{-1}y$$
</span>
</span></p>
<p>where <span class="math inline">\(A\)</span> is either <span class="math inline">\(A_I\)</span> or <span class="math inline">\(A_C\)</span>, depending on model type, <span class="math inline">\(y\)</span> a vector of the same length as <span class="math inline">\(A\)</span> with zeroes for all sectors except the sector of interest, where the value is set to $1 million USD. This is turn used to calculate a matrix of total emissions by root emitting sector, <span class="math inline">\(M_d\)</span> <span class="math display">

<br><br><span class="equ">
  $$M_d = B\hat{s}$$
</span>
</span></p>
<p>We also estimate the potential impacts of the margins activities associated with industries and commodities, using the same margin data along with model estimates for supply chain emissions for each sector comprising the margins. We break <span class="math inline">\(\Phi\)</span> down into its margin transportation, <span class="math inline">\(t\)</span>, wholesale, <span class="math inline">\(w\)</span>, and retail, <span class="math inline">\(r\)</span> sectors:</p>
<p><span class="math display">

<span class="equ">
  $$\Phi_C = \Phi_C,t + \Phi_C,w + \Phi_C,r$$
</span>
</span></p>
<p>For each margin components, we allocate margin type across all margin sectors associated with that type, for example, for retail we need to allocate the retail margins across model retail sectors. For this We develop a margin allocation matrix, <span class="math inline">\(MA\)</span>, with rows for each of the margin components and columns for all model margin sectors. We allocate across sectors of a given margin type based on relative commodity output of the model sectors for that margin type. Note this procedure does not result in commodity or industry-specific margins types. We assemble the sector-specific margin coefficients into a commmodity by coefficient matrix, <span class="math inline">\(P\)</span>. We then multiply the margin coefficients matrix by the margin allocation matrix <span class="math display">

<br><br><span class="equ">
  $$P_a =  P * MA$$
</span>
</span></p>
<p>The result <span class="math inline">\(P_a\)</span> represents $ of margin input per $ producer price for each model sector by margin sector type. We transform the result, <span class="math inline">\(P_a\)</span>, into the shape of the <span class="math inline">\(A\)</span> matrix, to easily match up with the emissions factors, and name the reshaped form <span class="math inline">\(A_p\)</span>.</p>
<p>We derive emission factors for the margins with a multiplication of the original emission factor matrices, <span class="math inline">\(M\)</span> and <span class="math inline">\(U\)</span>, by <span class="math inline">\(Pa,x,y\)</span></p>
<p><span class="math display">

<span class="equ">
  $$M_p = M * A_p$$
</span>
</span></p>
<p><span class="math display">

<span class="equ">
  $$U_p = U * A_p$$
</span>
</span></p>
<p>Finally, <span class="math inline">\(M_p\)</span> and <span class="math inline">\(U_p\)</span> are adjusted to be in purchaser prices like what is done with <span class="math inline">\(M\)</span> and <span class="math inline">\(U\)</span> above.</p>
<p><span class="math display">

<span class="equ">
  $$\bar{M}_{p} = M_{p} * \hat{\Phi}$$
</span>
</span></p>
<p><span class="math display">

<span class="equ">
  $$\bar{U}_{p} = U_{p} * \hat{\Phi}$$
</span>
</span></p>
<p>where <span class="math inline">\(\hat{\Phi}\)</span> is for industries or commodities depending on the model.</p>
</div>
<div id="data-quality-scores-for-emission-factors" class="section level2">
<h2>Data quality scores for emission factors</h2>
<p>Data quality scores of 1-5 are assigned based on the US EPA LCA Data Quality system to values in <span class="math inline">\(B\)</span> for each of five indicators. These be represented in a matrix of the form of <span class="math inline">\(B\)</span> called <span class="math inline">\(B_{dqi,i}\)</span> created for each indicator <span class="math inline">\(i\)</span>. To scale these scores to put them to create scores for the supply chain emission factors in , this is multiplied by <span class="math inline">\(L\)</span>. <span class="math display">

<br><br><span class="equ">
  $$M_{dqi,i} = B_{dqi,i} * L$$
</span>
</span></p>
<p>where <span class="math inline">\(B\)</span> and <span class="math inline">\(L\)</span> may be either both for industry, <span class="math inline">\(B_I\)</span> and <span class="math inline">\(L_I\)</span> or commodity, <span class="math inline">\(B_C\)</span> or <span class="math inline">\(B_I\)</span> models.</p>
</div>
<div id="model-validation" class="section level2">
<h2>Model validation</h2>
<p>The validation of the supply chain factors is performed for each model from which the factors were derived. The validation test checks that the model supply chain GHG factors can be scaled back to total GHG industry emissions.</p>
<p>Mathematically, this validation test is based on the input-output identity that <span class="math inline">\(x=Ly\)</span>, where <span class="math inline">\(y\)</span> if the total final demand for commodities and industries. Therefore multiplying B by both sides, to scale output using the direct emission factors, should result in equality, <span class="math display">

<br><br><span class="equ">
  $$B*x = B*L*y$$
</span>
</span></p>
<p>This can be simplied in the form of the following equation.</p>
<p><span class="math display">

<span class="equ">
  $$Ei = (M*y)i + E_fi$$
</span>
</span></p>
<p>where <span class="math inline">\(i\)</span> is a column vector of 1s that acts as a summation vector. <span class="math inline">\(E_f\)</span> is a matrix of emissions associated with the final user, and final user sectors are not part of <span class="math inline">\(M\)</span>. This can be understood such that the sum of the supply chain GHG factors scaled for total final demand is the same as the sum of national GHG totals for each GHG.</p>
<p>The issue with the model <span class="math inline">\(M\)</span>, derived from the total requirements matrix, is that it includes foreign input requirements, and that final demand also includes imports. To use the model to estimate US-produced GHGs, then <span class="math inline">\(M\)</span> has to be created with domestic requirements only. This requires a recreation of an <span class="math inline">\(A\)</span> matrix with only domestic requriements. To do this, we modify the original Use table to remove foreign requirements using the Import matrix, <span class="math inline">\(I_m\)</span>.</p>
<p><span class="math display">

<span class="equ">
  $$U_d = U - I_m$$
</span>
</span></p>
<p>and then we subtract the final demand provided in the import matrix, <span class="math inline">\(Y'\)</span>, from the final demand in the original Use table, to get domestic final demand, <span class="math inline">\(Y_d\)</span>.</p>
<p><span class="math display">

<span class="equ">
  $$Y_d = Y - Y_d$$
</span>
</span></p>
<p>Then the <span class="math inline">\(A\)</span> matrix with just domestic direct requirements, <span class="math inline">\(A_d\)</span>, can be created using a similar derviation used for <span class="math inline">\(A\)</span> above. Note that normalized Make table transactions are not the same. The follow equation is demonstrated below for the commodity form of the model.</p>
<p><span class="math display">

<span class="equ">
  $$A_{d,C} = U_d\hat{x}^{-1} * V\hat{q}^{-1}$$
</span>
</span></p>
<p>We can follow from the steps to create <span class="math inline">\(M\)</span> from <span class="math inline">\(A\)</span> and apply them to create <span class="math inline">\(M_d\)</span> using the <span class="math inline">\(A_d\)</span>. This refines the data validation check to compare national GHG totals only to the sum of the supply chain factors based on domestic requirements scaled by the domestic final demand, as in the following equation: <span class="math display">

<br><br><span class="equ">
  $$Ei = (M_d * y_d)i + E_fi$$
</span>
</span></p>
<p>The difference between the left and right terms of the equations is evaluated per GHG and explained as a model error.</p>
</div>

<section id="regional">
  <h2>Regional Estimate of Commodity Output</h2>

  <p>For the IO chart, rather than use per $, we provide a regional estimate of commodity output <span class="math inline">\(q_c\)</span>.

  We show direct dollar amounts and direct impacts. This obviates the complexities of the indirect impact calculations in the IO chart.</p>

<p>
  <ul>
    <li>Upstream: We show total dollar amount of direct inputs for all combined commodities.

      <br><br><span class="equ">
        $$(q_c)*A$$
      </span>
      <br><br>
    </li>

    <li>Commodities: Do not select only the top 20 by default. Subselect indicators were direct impacts are relevant...this will exclude energy use and mineral use for instance. All impacts can be estimated through scaling of the <span class="math inline">\(D\)</span> matrix. 

      <br><br><span class="equ">
        $$(q_c)*D$$
      </span>
      <br><br>
    </li>

    <li>Downstream: Will show total dollar amount of direct uses for all combined commodities. 

      <br><br><span class="equ">
        $$A*(q_c)$$
      </span>
    </li>
  </ul>
</p>

  <p>To estimate commodity output for the total, we first estimate industry output, then apply the market shares transformation. The new API version (v1.2) and model v2.0 is used to get the needed data.</p>

  <p>We use industry payroll from the Bureau of Labor Statistics (BLS) as a proxy measure of industry output in the following manner:</p>

  <p><span class="equ">$$x_{i,c} = \frac{w_{i,c}}{w_{i,t}} * x_{i,t}$$</span></p>

  <p>where <span class="math inline">\(x_{i,c}\)</span> is industry output for industry i for the community c, <span class="math inline">\(w_{i,c}\)</span> is a community payroll for industry i, <span class="math inline">\(w_{i,t}\)</span> is a payroll for industry i in the IO model region (US for USEEIOv2.0), and <span class="math inline">\(x\)</span> is the model's provided industry output for industry i. This is a single industry formula but the calculation would be best implemented in a vector form using matrix multiplication to do all at once.</p>

  <p>In order to get the index of the payroll vectors to match the IO model industries, we relate the NAICS based payroll data to model sectors using the built-in API crosswalk where we assume the payroll sectors match those in the NAICS column and we aggregate it to model industries using the provided model industries column.</p>

  <p>Once we have a vector <span class="math inline">\(x_{c}\)</span> of industry output for the community indexed by the model industries, we use a market shares transformation to derive commodity output for the community, <span class="math inline">\(q_{c}\)</span>.</p>

  <p><span class="equ">$$q_c = x_c * V\hat{q}^{-1}$$</span></p>

  <p>where <span class="math inline">\(V\)</span> is the Make table and <span class="math inline">\(q\)</span> is the commodity output vector. More details on <span class="math inline">\(V_n\)</span> found in the <a href="https://github.com/USEPA/useeior/tree/master/format_specs">useeior model format spec</a>.</p>
<section>

</div>
<br><br>


</body>
</html>
